# 快速开始指南

## 5分钟上手 CSV客户信息查询工具 v2.0

---

## 步骤 1: 安装脚本

1. 安装 [Tampermonkey 浏览器扩展](https://www.tampermonkey.net/)
2. 打开 `csv_client_mapper.user.js` 文件
3. Tampermonkey 会自动识别并提示安装
4. 点击"安装"按钮

✅ 安装完成！你会在浏览器右上角看到 Tampermonkey 图标。

---

## 步骤 2: 配置API参数（首次使用必需）

### 2.1 登录ops平台

1. 访问 https://ops.planetmeican.com
2. 使用你的账号登录
3. 保持标签页打开

### 2.2 启动捕获模式

1. 在**任意网页**点击浏览器右上角的 **"📊 CSV工具"** 按钮
2. 工具面板打开后，看到 **"⚙️ API配置"** 区域
3. 配置状态显示 **"❌ 未配置"**
4. 点击 **"🎯 开始捕获请求"** 按钮

此时界面会显示：
```
⏳ 等待中...
请在 ops.planetmeican.com 搜索一次客户
```

### 2.3 触发API请求

1. 切换到 **ops.planetmeican.com** 标签页
2. 在搜索框输入**任意客户ID**（例如：`12345`）
3. 点击搜索按钮

### 2.4 配置成功

工具会自动弹出提示：
```
✅ API参数已成功捕获！

现在可以正常使用CSV工具了。
```

配置面板会更新为：
```
✅ 已配置
Token: eyJhbGc...xyz123
时间: 2025-10-28 14:30:00
```

🎉 **配置完成！** 现在可以开始使用CSV批量查询功能了。

---

## 步骤 3: 使用CSV批量查询

### 3.1 准备CSV文件

创建一个CSV文件，例如 `clients.csv`：

```csv
id,legacy_client_id,new_client_id,description
1,LC001,NC001,测试客户1
2,LC002,NC002,测试客户2
3,LC003,NC003,测试客户3
```

**注意事项**：
- 支持分号(`;`)或逗号(`,`)分隔
- 支持中文列名
- 列名中包含"legacy"和"client"的会自动识别为3.0客户ID列
- 列名中包含"new"和"client"的会自动识别为4.0客户ID列

### 3.2 上传并处理

1. 点击 **"📊 CSV工具"** 打开面板
2. **步骤1**: 点击"选择文件"，上传你的CSV
3. 工具会显示：
   ```
   文件已加载: clients.csv
   行数: 3
   列数: 4
   列名: id, legacy_client_id, new_client_id, description
   ```
4. **步骤2**: 选择列名
   - 3.0客户ID列：选择 `legacy_client_id`
   - 4.0客户ID列：选择 `new_client_id`
5. 点击 **"开始处理"** 按钮

### 3.3 等待处理完成

工具会显示实时进度：
```
已处理 1/3 行 (33%)
已处理 2/3 行 (67%)
已处理 3/3 行 (100%)
处理完成！
```

### 3.4 下载结果

点击 **"下载处理后的CSV"** 按钮，会下载一个新文件：

```csv
id,legacy_client_id,new_client_id,description,3.0客户,4.0客户
1,LC001,NC001,测试客户1,张三公司,李四企业
2,LC002,NC002,测试客户2,王五集团,赵六科技
3,LC003,NC003,测试客户3,孙七工厂,周八商贸
```

🎊 **完成！** 新的CSV文件中已添加了客户名称列。

---

## 常见问题

### Q1: 提示"API配置未找到或已过期"

**原因**: 配置缺失或超过7天过期

**解决方法**:
1. 点击配置区域的 **"🔄 重新捕获"** 按钮
2. 或点击 **"🎯 开始捕获请求"** 按钮
3. 按照步骤2重新配置

### Q2: 点击"开始捕获"后一直等待

**原因**: 没有在ops网站触发API请求

**解决方法**:
1. 确认已在 https://ops.planetmeican.com 登录
2. 在ops网站的搜索框输入任意客户ID
3. 点击搜索按钮（必须触发API调用）

### Q3: 查询结果显示"查询失败"

**可能原因**:
- Token已过期（重新捕获配置）
- 客户ID不存在（正常情况，会显示空）
- 网络问题（检查网络连接）

**解决方法**:
1. 查看浏览器控制台（F12）查看详细错误
2. 重新捕获API配置
3. 确认客户ID是否正确

### Q4: CSV文件列名识别错误

**解决方法**:
手动选择正确的列名即可，工具的自动识别只是辅助功能。

### Q5: 工具按钮不显示

**可能原因**:
- Tampermonkey未启用
- 脚本未安装成功

**解决方法**:
1. 点击浏览器右上角的Tampermonkey图标
2. 确认"CSV客户信息查询工具"已启用（绿色勾选）
3. 刷新页面

---

## 进阶使用

### 折叠配置面板

配置完成后，可以折叠API配置面板节省空间：
1. 点击配置面板右上角的 **▼** 按钮
2. 面板会折叠，只显示配置状态
3. 需要时可以再次点击 **▶** 展开

### 查看配置详情

1. 展开配置面板
2. 查看Token预览（脱敏显示）
3. 查看捕获时间
4. 检查配置状态

### 批量处理技巧

1. **分批处理**: 如果CSV文件很大（>1000行），建议分批处理
2. **网络延迟**: 工具会自动在每次查询间添加100ms延迟，避免请求过快
3. **错误处理**: 单个查询失败不会影响其他行的处理

---

## 系统要求

- ✅ 现代浏览器（Chrome、Firefox、Edge、Safari）
- ✅ Tampermonkey扩展
- ✅ 网络连接
- ✅ ops.planetmeican.com 账号权限

---

## 数据安全

- 所有处理在**本地浏览器**完成
- 配置保存在**本地localStorage**
- 不上传任何数据到第三方服务器
- Token仅用于API调用，不会泄露

---

## 下一步

- 📖 阅读 [完整文档](README.md)
- 🏗️ 了解 [系统架构](ARCHITECTURE.md)
- 📝 查看 [版本说明](V2_RELEASE_NOTES.md)
- 🔧 查看 [请求拦截方案](REQUEST_CAPTURE_PLAN.md)

---

**需要帮助？** 查看浏览器控制台（F12）获取详细错误信息。
